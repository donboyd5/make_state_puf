---
title: "State TaxData Project"
author: Don Boyd
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_notebook: 
    df_print: paged
    toc: yes
    toc_depth: 5
    number_sections: true
editor_options: 
  chunk_output_type: console
---

# Project Statement of Work
See [this](https://docs.google.com/document/d/1K-3V3Acfeoyc5VvcPNnfsFkUq37fgMQEOSmR3_yGENA/edit?usp=sharing).

The primary goals of this project are to (1) adapt and extend methods and tools developed in previous incubator projects, allowing us to develop state-specific income tax microdata files from the existing IRS SOI national Public Use File (PUF), and (2) develop at least one preliminary file for one state.


# Yimeng's Project Statement of Work
> Augment Boydâ€™s current project in which he is developing methods for creating a single state microdata tax file, in two ways: (a) rigorously compare file quality under several different approaches under investigation, and (b) port the approach that produces the best results from R to Python so that it can readily be integrated with TaxData.


<!-- First set things up, then run things -->


# Set things up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
```


```{r system_specific_info, include=FALSE}
# change these as needed
# pufdir <- "C:/Users/donbo/Dropbox/OSPC - Shared/IRS_pubuse_2011/"

```


```{r loads}
source(here::here("r/includes", "libraries.r"))
source(here::here("r/includes", "globals.r"))
globals
source(here::here("r/includes", "functions_state_puf.r"))

```



# Outline of work

1. ONETIME:
    + Get and save 2011 targets for all states
    + Get and save an rds version of the PUF, with aggregate records excluded
    + Get and save ratio-adjusted weights for all states



# Steps

## Get and save targets for all states

```{r ONETIME}
# create a clean file of 2011 SOI Historical Table 2 targets, all states, saved in data/hist2_2011.csv
source(here::here("r", "0a_prepare_soi2011_targets_csvformat.r"))
save_soi2011_targets_csvformat(globals) # creates ./data/hist2_2011.rds with soi targets all states
# readRDS(here::here("data", "hist2_targets2011.rds"))

source(here::here("r", "0b_prepare_soicsv_targets.r"))
prepare_soicsv_targets_long(globals, 2017) # creates ./data/hist2_2011.rds with soi targets all states
# readRDS(here::here("data", paste0("hist2_targets", 2017, ".rds")))

# puf <- get_puf_xagg() # ORIGINAL PUF less the 4 aggregate records, with a wt variable
# glimpse(puf)

# prepare puf for tax-calculator and get 2017 agi

# Prepare a file for each year with RECID and ratio-adjusted weights for EACH state
source(here::here("r", "0b_prepare_ratio_adjusted_state_weights.r"))


```

